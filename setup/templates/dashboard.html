<!DOCTYPE html>
<html lang="pt-br">
<head>
    {% load static %}
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard do Aluno</title>
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}" />
</head>
<body>
    <div class="sidebar">
        <img src="{% static 'images/evolua-logo-branco(1).svg' %}" alt="Evolua Logo" />
        <a href="{% url 'setup:dashboard' %}">Visão Geral</a>
        <a href="#semestre">Semestres</a>
        <a href="{% url 'setup:quiz' %}">Trilha de Aprendizagem</a>
        <a href="{% url 'setup:login' %}">Sair</a>
    </div>

    <div class="main-content">
        <div class="header">
            <h1>Visão Geral</h1>
            <div class="student-info">
                <span>ALUNO(A): </span>
                <h3>{{ aluno }}</h3>
            </div>
        </div>

        <div class="card-container">
            <div class="card">
                <h3>Progresso</h3>
                <p>{{ progresso }}%</p>
            </div>
            <div class="card">
                <h3>Quizzes Respondidos</h3>
                <p>{{ quizzes_respondidos }}</p>
            </div>
            <div class="card">
                <h3>Atividades Pendentes</h3>
                <p>{{ atividades_pendentes }}</p>
            </div>
            <div class="card">
                <h3>Nota Média</h3>
                <p>{{ nota_media }}</p>
            </div>
        </div>

        <div class="content-container">
            <div class="chart-container">
                <h3>Desempenho</h3>
                <canvas id="chart"></canvas>
            </div>
            <div class="quiz-history">
                <h3>Histórico de Quizzes</h3>
                {% for quiz in historico_quizzes %}
                <div class="quiz-item">
                    <span>{{ quiz.pilar }}</span><span>Nota: {{ quiz.nota }}</span>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="foil-container">
            <h2>Pilares FOIL</h2>
            {% for pilar, descricao in pilares %}
            <div class="valores-foil">
                <p>{{ pilar }}</p>
                <p>{{ descricao }}</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
      const ctx = document.getElementById("chart");
  
      // Certifique-se de que os dados existem antes de criar o gráfico
      {% if meses and notas %}
      const meses = {{ meses | safe }};
      const notas = {{ notas | safe }};
  
      if (ctx && Array.isArray(meses) && Array.isArray(notas)) {
          const chart = new Chart(ctx.getContext("2d"), {
              type: "line",
              data: {
                  labels: meses,
                  datasets: [
                      {
                          label: "Nota Média por Mês",
                          data: notas,
                          borderColor: "rgba(75, 192, 192, 1)",
                          borderWidth: 2,
                          fill: false,
                      },
                  ],
              },
              options: {
                  responsive: true,
                  scales: {
                      y: {
                          beginAtZero: true,
                          max: 10,
                      },
                  },
              },
          });
      } else {
          console.error("Os dados para o gráfico são inválidos.");
      }
      {% else %}
      console.error("Dados insuficientes para renderizar o gráfico.");
      {% endif %}
  </script>
</body>
</html>
